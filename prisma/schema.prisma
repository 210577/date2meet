generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Event {
  id        String   @id @default(cuid())
  slug      String   @unique
  title     String
  startDate DateTime // stored as UTC midnight-equivalent; we’ll treat as KST-date logically
  endDate   DateTime
  createdAt DateTime @default(now())

  responses Response[]
}

model Response {
  id           String   @id @default(cuid())
  eventId      String
  userId       String   // user-chosen ID (displayed)
  passwordHash String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)
  selections ResponseSelection[]

  @@unique([eventId, userId]) // one response per userId per event
  @@index([eventId])
}

model ResponseSelection {
  id         String   @id @default(cuid())
  responseId String
  date       DateTime // one per day (we treat it as a “date”)
  createdAt  DateTime @default(now())

  response Response @relation(fields: [responseId], references: [id], onDelete: Cascade)

  @@unique([responseId, date]) // no duplicates
  @@index([date])
}
